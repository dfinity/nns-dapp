<script lang="ts">
  import TestIdWrapper from "$lib/components/common/TestIdWrapper.svelte";
  import { emptyAddress } from "$lib/utils/accounts.utils";
  import type { Account } from "$lib/types/account";
  import NnsAddress from "./NnsAddress.svelte";
  import NnsSelectAccount from "./NnsSelectAccount.svelte";
  import { createEventDispatcher, onMount } from "svelte";

  let address: string;
  let mounted = false;

  onMount(() => (mounted = true));

  const onEnterAddress = () => chooseDestinationAddress(address);

  const onSelectAccount = ({
    detail,
  }: CustomEvent<{ selectedAccount: Account }>) =>
    chooseDestinationAddress(detail.selectedAccount.identifier);

  const dispatcher = createEventDispatcher();
  const chooseDestinationAddress = (destinationAddress: string) =>
    dispatcher("nnsAddress", { address: destinationAddress });
</script>

<TestIdWrapper testId="nns-destination-address-component">
  <NnsAddress bind:address on:submit={onEnterAddress} />

  <!-- Prevent the component to be presented with a scroll offset when navigating between wizard steps -->
  <!-- note about disableSelection: if user is entering an address with the input field, the address is not empty and therefore no account shall be selected -->
  {#if mounted}
    <NnsSelectAccount
      on:nnsSelectAccount={onSelectAccount}
      disableSelection={!emptyAddress(address)}
      displayTitle={true}
    />
  {/if}
</TestIdWrapper>
