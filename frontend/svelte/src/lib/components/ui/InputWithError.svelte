<script lang="ts">
  import IconInfo from "../../icons/IconInfo.svelte";
  import Input from "./Input.svelte";

  // Same props as Input
  export let name: string;
  export let inputType: "number" | "text" = "number";
  export let required: boolean = true;
  export let spellcheck: boolean | undefined = undefined;
  export let step: number | "any" | undefined = undefined;
  export let disabled: boolean = false;
  export let minLength: number | undefined = undefined;
  export let max: number | undefined = undefined;
  export let errorMessage: string | undefined = undefined;
  // https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/autocomplete
  export let autocomplete: "off" | "on" | undefined = undefined;
  export let value: string | number | undefined = undefined;
  export let placeholderLabelKey: string;
  export let theme: "dark" | "light" = "light";
</script>

<div class="wrapper" class:error={errorMessage !== undefined}>
  <Input
    {theme}
    {inputType}
    {required}
    {spellcheck}
    {name}
    {step}
    {disabled}
    {minLength}
    {placeholderLabelKey}
    {max}
    {autocomplete}
    bind:value
    on:blur
    on:input
  >
    <slot name="button" slot="button" />
  </Input>

  {#if errorMessage !== undefined}
    <p class={`error-message ${theme}`}>
      <IconInfo />
      <span>
        {errorMessage}
      </span>
    </p>
  {/if}
</div>

<style lang="scss">
  @use "../../themes/mixins/media.scss";

  .wrapper {
    position: relative;
    width: 100%;

    // Leave enough space for the error message
    margin-bottom: var(--padding-6x);
  }

  .error {
    --input-error-color: var(--error);
  }

  .error-message {
    font-size: var(--font-size-ultra-smal);

    margin: 0;

    // Avoid layout shift
    position: absolute;
    // Error message within the margin-bottom of the wrapper
    bottom: calc(-1 * var(--padding-2x));
    // To have the same spacing as the input
    border: 1px solid transparent;

    display: flex;
    align-items: center;
    gap: var(--padding-0_5x);

    color: var(--error);

    span {
      color: var(--gray-600);
    }

    @include media.min-width(medium) {
      padding: 0 var(--padding-2x);
    }

    &.dark {
      span {
        color: var(--gray-400);
      }
    }
  }
</style>
