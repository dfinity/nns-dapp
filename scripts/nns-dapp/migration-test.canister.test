#!/usr/bin/env bash
set -euo pipefail
. "${0%.test}"

# Prints a section title
title() {
  cat <<-EOF

	=============================================================================
	   $*
	=============================================================================
	EOF
}

(
  title Schema converters should give expected values
  for index in "${!SCHEMA_LABELS[@]}"; do
    EXPECTED_NAME="${SCHEMA_LABELS[$index]}"
    ACTUAL_NAME="$(schema_name "$index")"
    [[ "$EXPECTED_NAME" == "$ACTUAL_NAME" ]] || {
      echo "ERROR: Failed to get the name of schema index '$index'."
      echo "Expected: '$EXPECTED_NAME'"
      echo "Expected: '$ACTUAL_NAME'"
      exit 1
    } >&2
    ACTUAL_INDEX="$(schema_index "$EXPECTED_NAME")"
    ((index == ACTUAL_INDEX)) || {
      echo "ERROR: Failed to get the index of schema '$EXPECTED_NAME'."
      echo "Expected: '$index'"
      echo "Expected: '${ACTUAL_INDEX:-}'"
      exit 1

    }

  done

)

echo "$(basename "$0") PASSED"
