<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>SNS aggregator</title>
    <style>
	article {
	  display: flex;
	  align-items: center;
	}

    img {
        width: 100px;
        aspect-ratio: 1/1;
    }
    </style>
  </head>
  <body>
	  <h1>SNS aggregator</h1>
	  <p>The aggregator collects information on all deployed SNS and re-publishes aggegate values as certified query calls.  This data is intended for use by any canister that wishes to provide dashboards.  The data will typically be updated about once per minute.  Collecting the data from this aggregator will typically be much faster than collecting the same data directly from the SNSs.</p>
	  <ul>
		  <li><a href="/v1/sns/list/latest/slow.json">The latest SNSs</li>
		  <li><a href="/v1/sns/list/page/0/slow.json">A paginated list of SNSs</a></li>
          <li>Slow data for one SNS is at: /v1/sns/root/$CANISTER_ID/slow.json</li>
          <li>The SNS logo is at: /v1/sns/root/$CANISTER_ID/logo.png</li>
      </ul>
      <h2>Recent SNSs</h2>

      <script>
          // Mainnet: https://3r4gx-wqaaa-aaaaq-aaaia-cai.raw.icp0.io/v1/sns
          // Use the above for local development of this HTML page
          const aggregatorUrl = "";

          const renderSns = ({canister_ids: {root_canister_id}, meta: {name}}) => {
              const article = document.createElement("article");

              const img = document.createElement("img");
              img.loading = "lazy";
              img.src = `${aggregatorUrl}/root/${root_canister_id}/logo.png`;

              const a = document.createElement("a");
              a.href = `${aggregatorUrl}/root/${root_canister_id}/slow.json`;
              a.text = name;

              article.appendChild(img);
              article.appendChild(a);

              return article;
          }

          const renderSnses = (latest) => {
              const fragment = document.createDocumentFragment();
              fragment.append(...latest.map(renderSns));

              document.querySelector("script")?.after(fragment);
          }

          const loadSnses = () => fetch(`${aggregatorUrl}/list/latest/slow.json`).then(response => response.json()).then(latest => renderSnses(latest));

          document.addEventListener("DOMContentLoaded", loadSnses, {once: true});
      </script>
  </body>
</html>
